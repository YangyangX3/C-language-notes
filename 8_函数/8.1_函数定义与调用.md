---
title: 函数定义与调用
tags:
  - C语言
  - 函数
  - 定义
  - 调用
  - 返回值
  - void
  - 代码复用
  - 模块化
---

# 8.1 函数定义与调用

函数是 C 语言中组织代码的基本单元，它允许我们将一个复杂的任务分解成若干个更小、更易于管理的部分，实现代码的复用和模块化。

## 什么是函数

### 学习要点

*   **代码块**: 函数是一段被命名的、可重复使用的代码块，用于执行特定的任务。
*   **输入 (参数)**: 函数可以接收零个或多个输入值，称为参数，函数根据这些参数来执行操作。
*   **处理**: 函数内部包含一系列语句，用于执行特定的计算、判断、循环等操作。
*   **输出 (返回值)**: 函数可以返回零个或一个计算结果，称为返回值。

### 概念解析与代码示例

*   **函数的目的**: 主要目的是将一段具有特定功能的代码封装起来，并赋予一个名字。当需要执行这个功能时，只需通过函数名调用即可，避免了重复编写相同的代码（代码复用）。同时，将大程序分解为小函数，使得程序结构更清晰，更易于理解和维护（模块化）。

*   **与数学函数的类比**: 类似于数学中的 `y = f(x)`，`f` 是函数名，`x` 是输入（自变量），`y` 是输出（结果）。编程中的函数概念更广，可以没有输入参数，也可以没有返回值（仅执行某些操作）。

## 函数定义

### 学习要点

*   **函数头 (Header)**:
    *   **返回类型 (Return Type)**: 指定函数执行完毕后返回的数据类型。如果函数不返回任何值，则使用 `void`。
    *   **函数名 (Function Name)**: 用于标识和调用函数的名称，遵循标识符命名规则。
    *   **参数列表 (Parameter List)**: 位于圆括号 `()` 内，用于声明函数接收的参数。每个参数都包含类型和名称，多个参数之间用逗号 `,` 分隔。如果函数不接收任何参数，参数列表可以写 `(void)` 或留空（但不推荐留空）。
*   **函数体 (Body)**:
    *   位于一对大括号 `{}` 内，包含实现函数功能的具体语句。
    *   大括号是必需的，即使函数体只有一条语句。

### 概念解析与代码示例

*   **函数结构**: 一个完整的函数定义包括函数头和函数体。函数头定义了函数的"接口"（如何调用它，它返回什么），函数体定义了函数的"实现"（它具体做什么）。

    ```c
    // (补充示例) 函数定义结构
    // 函数头: 返回类型 函数名(参数列表)
    int add(int a, int b) 
    { // 函数体开始
        // 函数体内的语句
        int sum = a + b;
        return sum; // 返回计算结果
    } // 函数体结束

    // 不接收参数，不返回值的函数
    void print_hello(void) 
    {
        printf("Hello!\n");
        // 没有 return 语句，或使用 return;
    }
    ```

## 函数调用

### 学习要点

*   **调用语法**: 使用函数名后跟一对圆括号 `()` 来调用函数。
*   **传递参数 (Arguments)**: 如果函数定义了参数，调用时必须在圆括号内提供相应数量和类型的值（或可以隐式转换为参数类型的值），这些值称为实际参数（简称实参或参数值）。实参的顺序必须与定义中参数列表的顺序一致。
*   **圆括号的重要性**: 即使函数没有参数，调用时也必须写圆括号 `()`。否则，编译器不会将其识别为函数调用。

### 概念解析与代码示例

*   **执行流程**: 当程序执行到函数调用语句时，控制权会跳转到被调用函数的起始处。调用时提供的**值**（实参）会被用来初始化函数定义中的**参数**（形参）。函数体内的语句按顺序执行。执行完毕（遇到 `return` 或到达函数体末尾）后，控制权返回到调用点，程序继续执行后续语句。

    ```c
    // (补充示例) 函数调用
    #include <stdio.h>

    // 函数原型声明 (后面会详细讲)[[8.2_参数与局部变量]]
    int add(int a, int b);
    void print_hello(void);

    int main() {
        int x = 10, y = 5;
        int result;

        // 调用 add 函数，传递 x 和 y 的值
        result = add(x, y); // result 将接收 add 函数的返回值 (15)
        printf("Sum: %d\n", result);

        // 调用 add 函数，传递字面量
        result = add(100, 200);
        printf("Sum: %d\n", result);

        // 调用 print_hello 函数 (无参数)
        print_hello(); // 必须有圆括号

        // 错误示例：没有圆括号，不会调用函数
        // print_hello; // 这通常没有效果，或有其他含义

        return 0;
    }

    // 函数定义
    int add(int a, int b) {
        return a + b;
    }

    void print_hello(void) {
        printf("Hello!\n");
    }
    ```

## `return` 语句

### 学习要点

*   **功能**:
    1.  **终止函数**: 一旦执行到 `return` 语句，函数立即结束执行，并将控制权返回给调用者。
    2.  **返回值**: 如果 `return` 后面带有表达式（或值），该表达式的值将作为函数的返回值，返回给调用者。返回值的类型必须与函数定义中声明的返回类型兼容。
*   **`void` 函数**: 返回类型为 `void` 的函数表示不返回值。
    *   可以使用不带值的 `return;` 语句来提前结束函数。
    *   如果省略 `return;`，函数会在执行完最后一条语句后自动返回。
*   **非 `void` 函数**: 必须包含至少一个 `return` 语句来返回一个符合其声明类型的值。逻辑上需要保证所有可能的执行路径都有返回值（编译器通常会检查）。
*   **单一出口原则**: 虽然一个函数可以包含多个 `return` 语句，但为了代码清晰和易于维护，通常推荐使用"单一出口"原则，即尽量保证函数只有一个 `return` 语句（通常在函数末尾），通过控制一个局部变量的值来实现不同路径返回不同结果。但这并非强制规则，有时在函数开头进行错误检查并提前返回更简洁。

### 概念解析与代码示例

*   **返回值的使用**: 函数的返回值可以被赋给变量，用在表达式中，或作为另一个函数的参数。如果调用者不使用返回值（例如 `print_hello();`），返回值会被丢弃。

    ```c
    // (补充示例) return 语句
    #include <stdio.h>

    int get_positive_or_zero(int num) {
        if (num < 0) {
            return 0; // 如果 num 小于 0，返回 0 并结束函数
        }
        // 如果 num 不小于 0，执行到这里
        return num; // 返回 num 本身
    }

    void check_number(int n) {
        if (n == 0) {
            printf("Number is zero.\n");
            return; // 提前结束 void 函数
        }
        if (n > 0) {
            printf("Number is positive.\n");
        } else {
            printf("Number is negative.\n");
        }
        // 到达 void 函数末尾也会自动返回
    }

    // 不推荐的多出口风格示例
    int max_multiple_returns(int a, int b) {
        if (a > b) {
            return a; // 出口1
        } else {
            return b; // 出口2
        }
    }
    
    // 推荐的单一出口风格示例
    int max_single_return(int a, int b) {
        int result;
        if (a > b) {
            result = a;
        } else {
            result = b;
        }
        return result; // 单一出口
    }


    int main() {
        int val1 = get_positive_or_zero(5);  // val1 = 5
        int val2 = get_positive_or_zero(-3); // val2 = 0
        printf("val1: %d, val2: %d\n", val1, val2);

        check_number(10);
        check_number(0);
        check_number(-5);

        // 调用函数，但不使用返回值
        get_positive_or_zero(100); // 返回的 100 被丢弃

        return 0;
    }
    ``` 