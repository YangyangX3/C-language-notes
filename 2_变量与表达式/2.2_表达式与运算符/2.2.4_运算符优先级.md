---
title: 运算符优先级与结合性
tags:
  - C语言
  - 运算符
---

# 2.2.4 运算符优先级与结合性

当一个表达式中包含多个运算符时，计算的顺序由运算符的**优先级 (Precedence)** 和 **结合性 (Associativity)** 决定。这类似于数学中先乘除后加减的规则。

## 优先级 (Precedence)

-   **定义**: 不同运算符之间执行的先后顺序。优先级高的运算符先于优先级低的运算符进行计算。
-   **类比**: 数学中 `*` 和 `/` 的优先级高于 `+` 和 `-`。表达式 `a + b * c` 中，`b * c` 会先计算。
-   **C语言部分优先级 (由高到低)**:
    1.  括号 `()`: 拥有最高优先级，用于强制改变运算顺序。
    2.  单目运算符: `++` (后缀), `--` (后缀), `!` (逻辑非), `~` (按位取反), `+` (正号), `-` (负号), `*` (指针解引用), `&` (取地址), `sizeof`, `++` (前缀), `--` (前缀) 等。
    3.  乘法、除法、取余: `*`, `/`, `%`
    4.  加法、减法: `+`, `-`
    5.  移位运算符: `<<`, `>>` (后续章节)
    6.  关系运算符: `<`, `<=`, `>`, `>=`
    7.  相等性运算符: `==`, `!=`
    8.  按位与: `&` (后续章节)
    9.  按位异或: `^` (后续章节)
    10. 按位或: `|` (后续章节)
    11. 逻辑与: `&&`
    12. 逻辑或: `||`
    13. 条件运算符: `?:` (三元运算符)
    14. 赋值运算符: `=`, `+=`, `-=`, `*=`, `/=`, `%=` 等。
    15. 逗号运算符: `,`

-   **示例**:
    -   `a = b + c * d;` // `*` 优先级高于 `+` 和 `=`，先算 `c * d`，再算 `b + (结果)`，最后赋值给 `a`。
    -   `a > b && c < d;` // `>` 和 `<` 优先级高于 `&&`，先算 `a > b` 和 `c < d`，再将两个布尔结果进行逻辑与运算。
    -   `++a * b;` // 前缀 `++` 优先级高于 `*`，先算 `++a` (a自增1)，再用 a 的新值乘以 `b`。
    -   `a++ * b;` // 后缀 `++` 优先级高于 `*`，但是后缀运算特殊：先用 a 的**原值**乘以 `b` 计算表达式结果，然后 a 再自增1。

## 结合性 (Associativity)

-   **定义**: 当一个表达式中出现**多个相同优先级**的运算符时，决定运算执行方向的规则（从左到右，或从右到左）。
-   **左结合 (Left-to-right)**: 大多数二元运算符（如 `+`, `-`, `*`, `/`, `%`, `&&`, `||` 等）是左结合的。计算从左向右进行。
    -   示例: `a - b + c` 等价于 `(a - b) + c`。先算 `a - b`，再用结果加 `c`。
    -   示例: `a * b / c` 等价于 `(a * b) / c`。先算 `a * b`，再用结果除以 `c`。
-   **右结合 (Right-to-left)**:
    -   **赋值运算符*** (`=`, `+=`, `-=` 等) 是右结合的。计算从右向左进行。
        -   示例: `a = b = c;` 等价于 `a = (b = c);`。先将 `c` 的值赋给 `b`，然后将 `b = c` 这个赋值表达式的结果（也就是 `b` 的新值）再赋给 `a`。实现了将 `c` 的值同时赋给 `a` 和 `b`。
    -   **单目运算符** (`+`, `-`, `!`, `~`, `++`(前缀), `--`(前缀), `*`(解引用), `&`(取地址), `sizeof`) 和**条件运算符** (`?:`) 也是右结合的。
        -   示例: `*p++` (指针相关的复杂情况，后缀`++`优先级高但结合性在此处不关键，关键是`*`和`++`的相互作用，后续指针章节详解)。
        -   示例: `a = - + b;` // 非法语法，但如果合法，右结合意味着先处理 `+b` (正号)，再处理 `- (结果)` (负号)。

## 使用括号 `()`

-   括号 `()` 具有最高优先级。
-   可以使用括号来**强制改变**运算的自然顺序，或者**提高代码的可读性**，即使不加括号优先级也正确。
-   示例:
    -   ` (a + b) * c ` // 强制先计算 `a + b`。
    -   ` result = (a > b) && (c < d); ` // 括号使逻辑更清晰，虽然不加括号优先级也一样。

## 总结与建议

-   **无需死记**: 不需要死记硬背完整的优先级表。常用的优先级（括号 > 单目 > 乘除模 > 加减 > 关系 > 相等 > 逻辑 > 赋值）会随着编程实践逐渐熟悉。
-   **勤用括号**: 当不确定优先级或为了让代码意图更清晰时，**毫不犹豫地使用括号 `()`**。这可以避免因优先级记错导致的难以发现的逻辑错误，并极大提高代码的可读性和可维护性。
-   **理解赋值**: 赋值运算符 `=` 优先级很低，通常在其他计算完成后才执行。同时它是右结合的。
-   **注意自增自减**: 特别注意前缀/后缀自增自减运算符与其他运算符混合使用时的优先级和求值顺序，尽量避免写出过于复杂的此类表达式。 