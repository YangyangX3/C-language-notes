---
title: 嵌套 if-else
tags: [C语言, 控制流, 条件语句, if, else, 嵌套if, 逻辑与]
---

# 3.1.3 嵌套 if-else

`if` 或 `else` 后面所跟的代码块（或单条语句）本身也可以是另一个 `if` 或 `if-else` 语句。这种结构称为**嵌套 (Nested) 的 `if-else`**。

## 基本结构

```c
if ( <外层条件> ) {
    // 外层条件为真时执行
    if ( <内层条件1> ) {
        // 外层和内层条件1 都为真时执行
    } else {
        // 外层条件为真，但内层条件1 为假时执行
    }
} else {
    // 外层条件为假时执行
    if ( <内层条件2> ) {
        // 外层条件为假，且内层条件2 为真时执行
    } else {
        // 外层和内层条件2 都为假时执行
    }
}
```

-   **逻辑关系**: 内层的 `if` 只有在外层 `if` (或 `else`) 的条件满足时才会被判断和执行。
-   **缩进**: 良好的缩进对于理解嵌套结构至关重要。

## 示例：判断象限

假设要根据输入的坐标 `(x, y)` 判断其所在的象限：

```c
#include <stdio.h>

int main() {
    int x, y;
    printf("请输入坐标 (x y): ");
    scanf("%d %d", &x, &y);

    if (x > 0) { // 在右半平面
        if (y > 0) {
            printf("第一象限\n");
        } else if (y < 0) {
            printf("第四象限\n");
        } else { // y == 0
            printf("在 X 轴正半轴\n");
        }
    } else if (x < 0) { // 在左半平面
        if (y > 0) {
            printf("第二象限\n");
        } else if (y < 0) {
            printf("第三象限\n");
        } else { // y == 0
            printf("在 X 轴负半轴\n");
        }
    } else { // x == 0，在 Y 轴上
        if (y > 0) {
            printf("在 Y 轴正半轴\n");
        } else if (y < 0) {
            printf("在 Y 轴负半轴\n");
        } else { // y == 0
            printf("在原点\n");
        }
    }

    return 0;
}
```

## `else` 的匹配规则 (悬挂 `else` 问题)

当存在嵌套 `if` 且没有完全使用大括号 `{}` 时，`else` 的归属可能会产生歧义。C语言遵循以下规则：

> **`else` 总是与它前面最近的、尚未配对的 `if` 相匹配。**

**示例**: 
```c
int a = 1, b = 0;
if (a > 0)
    if (b > 0)       // 这个 if 没有配对的 else
        printf("A");
else                // 这个 else 匹配的是 if(b > 0)
    printf("B");
```
上述代码等价于：
```c
if (a > 0) {
    if (b > 0) {
        printf("A");
    } else {         // else 属于内层的 if(b > 0)
        printf("B");
    }
}
// 外层的 if(a > 0) 没有 else 部分
```
因为 `a > 0` 为真，`b > 0` 为假，所以程序会执行内层 `else`，输出 "B"。

**避免歧义**: 强烈建议**始终为 `if` 和 `else` 使用大括号 `{}`**，即使它们后面只有一条语句。这样可以明确代码结构，消除悬挂 `else` 的潜在问题。

```c
// 清晰的写法
if (a > 0) {
    if (b > 0) {
        printf("A");
    } 
    // 如果外层 if 需要 else，在这里添加
} else { 
    printf("C"); // 假设这是外层 if 的 else
}
```

## 嵌套 `if` 与逻辑运算符的等价与选择

-   详细：[[7.3_其他运算#逻辑运算符 (`!`, `&&`, ` `)]]

嵌套 `if` 语句所表达的复合条件，常常可以用逻辑运算符（`&&` - 逻辑与，`||` - 逻辑或）来写成单一的 `if` 语句，反之亦然。理解它们的等价关系有助于写出更简洁或更清晰的代码。

**1. `&&` (逻辑与) 与 嵌套 `if`**

判断"x 大于 0 **且** y 大于 0"：

-   **嵌套 `if`**:
-   **嵌套 `if`**: 
    ```c
    if (x > 0) {
        if (y > 0) {
            // x 和 y 都大于 0
        }
    }
    ```
-   **逻辑与 `&&`**: 
    ```c
    if (x > 0 && y > 0) {
        // x 和 y 都大于 0
    }
	    ```

在简单情况下，使用逻辑运算符通常更简洁。但当逻辑变得非常复杂时，适当的嵌套 `if` 可能更易于理解。
