---
title: 字符串基础
tags:
  - C语言
  - 字符串
  - 字符数组
  - 命令行参数
related_code:
  - "[[字符串输入输出.c]]"
---

# 字符串基础

## 字符串的定义

C语言中的字符串是以**零结尾**的一串字符，以字符数组的形式存储。字符串的末尾必须有一个空字符`'\0'`（ASCII值为0）作为结束标志，这样C语言才能确定字符串在何处结束。

```c
char word[7] = {'H', 'e', 'l', 'l', 'o', '!', '\0'};  // 正确的字符串
char arr[6] = {'H', 'e', 'l', 'l', 'o', '!'};         // 这只是字符数组，不是C字符串
```

没有结束的零字符`'\0'`，字符数组就不能被视为字符串，无法使用C语言的字符串处理函数。

### 零字符的表示

零字符可以有以下几种表示方法：
- `'\0'` - 字符形式（推荐使用，表意明确）
- `0` - 整数形式
- `(char)0` - 带类型转换的形式

注意：`'\0'`（ASCII值为0）与字符`'0'`（ASCII值为48）是不同的。

## 字符串的表示方法

### 字符串字面量

C语言中使用双引号括起来的内容是字符串字面量，编译器会自动在其末尾添加`'\0'`。

```c
char *str = "Hello, world!";  // 编译器自动添加'\0'
```

#### 字符串字面量的特性

1. **只读性**：字符串字面量存储在程序的代码段，是只读的
2. **相同字面量复用**：相同内容的字符串字面量通常会被编译器优化为同一个内存位置
3. **连接特性**：相邻的字符串字面量会被自动连接成一个

```c
// 相邻字符串自动连接
printf("Hello, " "world!"); // 等价于 printf("Hello, world!");

// 使用反斜杠连接多行字符串
printf("Hello, \
world!");
```

## 字符串变量

C语言中有两种主要方式来声明字符串变量：

### 1. 字符指针[^1]

```c
char *str = "Hello";
```

这种方式中，`str`是一个指针，指向一个只读的字符串字面量。**不能修改指针指向的字符串内容**。尝试修改会导致未定义行为，通常是程序崩溃。

```c
char *str = "Hello";
str[0] = 'B';  // 错误！会导致程序崩溃
```

### 2. 字符数组[^2]

```c
char str[] = "Hello";
```

这种方式中，在栈上创建了一个数组，字符串的内容被复制到这个数组中。可以修改字符数组中的内容。

```c
char str[] = "Hello";
str[0] = 'B';  // 正确，str变成了"Bello"
```

> **注意**：数组不能整体赋值，所以下面的代码是错误的：
> ```c
> char str[10];
> str = "Hello";  // 编译错误：数组类型不可赋值
> ```
> 正确的做法是使用`strcpy`函数：
> ```c
> char str[10];
> strcpy(str, "Hello");  // 正确的方式
> ```
> 数组初始化与赋值的详细解释可参见"[[9.1_一维数组#数组初始化与赋值的区别|9.1_一维数组]]"中的相关章节。

### 字符串变量选择原则

1. **构造可修改字符串**：使用字符数组
2. **处理固定字符串**：使用字符指针
3. **函数参数**：通常使用字符指针，因为数组作为参数会退化为指针
4. **动态分配内存**：使用字符指针配合`malloc()`

## 字符串输入输出

### 字符串输出

使用`printf()`函数的`%s`格式说明符输出字符串：

```c
char *str = "Hello";
printf("%s\n", str);  // 输出：Hello
```

### 字符串输入

使用`scanf()`函数的`%s`格式说明符读取字符串：

```c
char buffer[100];
scanf("%s", buffer);  // 读取一个单词到buffer
```

**安全问题**：`scanf()`不检查缓冲区大小，可能导致缓冲区溢出。为安全起见，应使用`%ns`限制读取的字符数量：

```c
char buffer[8];
scanf("%7s", buffer);  // 最多读取7个字符，留出空间给'\0'
```

### 字符串输入输出的注意事项

1. `%s`读取字符串直到遇到空白字符（空格、制表符、换行符）
2. 字符串输入不会包含空白字符
3. 指针型字符串变量必须指向有效的内存空间
4. 缓冲区溢出是常见的安全漏洞

## 字符串数组

字符串数组是存储多个字符串的数组。C语言中有两种主要方式来声明字符串数组：

### 1. 字符指针数组

```c
char *names[] = {"Alice", "Bob", "Charlie"};
```

每个元素是一个指向字符串字面量的指针。这种方式节省存储空间，但字符串内容不可修改。

### 2. 二维字符数组

```c
char names[3][10] = {"Alice", "Bob", "Charlie"};
```

这种方式创建了一个3行10列的二维数组，每行存储一个字符串。字符串内容可以修改，但每个字符串的最大长度受限于列数。

## 命令行参数

C程序的`main`函数可以接收命令行参数：

```c
int main(int argc, char *argv[])
{
    // argc: 参数数量
    // argv: 参数字符串数组
    for (int i = 0; i < argc; i++) {
        printf("argv[%d] = %s\n", i, argv[i]);
    }
    return 0;
}
```

- `argc`：命令行参数的数量（至少为1）
- `argv`：指向命令行参数的字符串数组
  - `argv[0]`：程序的名称或路径
  - `argv[1]`到`argv[argc-1]`：传递给程序的参数

## 常见错误与陷阱

1. **忘记字符串结尾的`'\0'`**
   ```c
   char word[5] = {'H', 'e', 'l', 'l', 'o'};  // 无结束符，不是有效的C字符串
   ```

2. **缓冲区溢出**
   ```c
   char name[5];
   scanf("%s", name);  // 危险！输入长度未限制
   ```

3. **修改字符串字面量**
   ```c
   char *str = "Hello";
   str[0] = 'B';  // 错误！修改只读内存
   ```

4. **未初始化的字符串指针**
   ```c
   char *str;
   scanf("%s", str);  // 错误！str未指向有效内存区域
   ```

5. **误认为字符指针即字符串**
   ```c
   char *str;  // 只是一个指针变量，不是字符串
   ```

## 相关源代码

完整代码示例请参考：![[../Assets/源代码/字符串输入输出.c]] 

[^1]: 指向一个**字符串字面量**的首地址

[^2]: `char str[] = "Hello";` 和 `char str[] ={'H','e','l','l','o','\0'};` **本质相同**，都是创建一个字符串数组，两者的区别仅在于语法糖（syntactic sugar）层面，但前者更简洁、安全，且编译器会自动帮你处理 `\0`，推荐使用。
