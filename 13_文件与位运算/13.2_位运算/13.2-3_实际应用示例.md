---
title: å®é™…åº”ç”¨ç¤ºä¾‹
tags:
  - Cè¯­è¨€
  - ä½è¿ç®—
  - åº”ç”¨å®ä¾‹
related_code:
  - "[[æŒ‰ä½è¿ç®—.c]]"
  - "[[æ•´æ•°å†…å­˜æ’åˆ—å’Œé€»è¾‘ä½æ¼”ç¤º.c]]"
  - "[[ç§»ä½è¿ç®—.c]]"
---

# ä½è¿ç®—çš„å®é™…åº”ç”¨ç¤ºä¾‹

ä½è¿ç®—åœ¨å®é™…ç¼–ç¨‹ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œå°¤å…¶åœ¨ç³»ç»Ÿç¼–ç¨‹ã€åµŒå…¥å¼ç³»ç»Ÿã€å›¾å½¢å¤„ç†ã€å¯†ç å­¦å’Œä¼˜åŒ–ç®—æ³•ç­‰é¢†åŸŸã€‚æœ¬æ–‡ä»‹ç»å‡ ä¸ªä½è¿ç®—çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚

## æ•°æ®å¤„ç†ä¸ä¼˜åŒ–

### 1. å¿«é€Ÿåˆ¤æ–­å¥‡å¶æ€§

ä½¿ç”¨æŒ‰ä½ä¸è¿ç®—ç¬¦åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºå¥‡æ•°ï¼š

```c
if (number & 1) {
    // number æ˜¯å¥‡æ•°
} else {
    // number æ˜¯å¶æ•°
}
```

è¿™æ¯”ä½¿ç”¨æ¨¡è¿ç®—ï¼ˆ`number % 2 == 1`ï¼‰æ›´é«˜æ•ˆï¼Œå› ä¸ºä½è¿ç®—é€šå¸¸åªéœ€ä¸€ä¸ªCPUå‘¨æœŸã€‚

### 2. ä¸ä½¿ç”¨ä¸´æ—¶å˜é‡äº¤æ¢ä¸¤ä¸ªæ•°

```c
a = a ^ b;
b = a ^ b;  // ç°åœ¨ b = åŸæ¥çš„ a
a = a ^ b;  // ç°åœ¨ a = åŸæ¥çš„ b
```

åŸç†åˆ†æï¼š
- ç¬¬ä¸€æ­¥ï¼š`a = a ^ b`
- ç¬¬äºŒæ­¥ï¼š`b = (a ^ b) ^ b = a ^ (b ^ b) = a ^ 0 = a`
- ç¬¬ä¸‰æ­¥ï¼š`a = (a ^ b) ^ a = (a ^ a) ^ b = 0 ^ b = b`

> âš ï¸ **æ³¨æ„**ï¼šè¿™ç§æ–¹æ³•åœ¨ a å’Œ b æŒ‡å‘åŒä¸€å†…å­˜ä½ç½®æ—¶ä¼šå¤±è´¥ï¼Œå› ä¸ºç¬¬ä¸€æ­¥æ“ä½œä¼šä½¿åŸå§‹å€¼ä¸¢å¤±ã€‚

### 3. è®¡ç®—ç»å¯¹å€¼ï¼ˆä»…é€‚ç”¨äºç‰¹å®šæ¶æ„ï¼‰

```c
int abs(int x) {
    int mask = x >> 31;  // å¦‚æœxä¸ºè´Ÿï¼Œmaskå…¨ä¸º1ï¼›å¦åˆ™maskå…¨ä¸º0
    return (x + mask) ^ mask;
}
```

æ­¤æ–¹æ³•åˆ©ç”¨ç®—æœ¯å³ç§»çš„ç‰¹æ€§ï¼Œé¿å…äº†åˆ†æ”¯åˆ¤æ–­ã€‚

## ä½å›¾ä¸æ ‡å¿—å¤„ç†

### 1. ä½å›¾æ•°æ®ç»“æ„

ä½å›¾ä½¿ç”¨æ¯ä¸ªæ¯”ç‰¹ä½è¡¨ç¤ºä¸€ä¸ªå¸ƒå°”çŠ¶æ€ï¼Œæ˜¯ä¸€ç§ç©ºé—´é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼š

```c
#define MAX_ELEMENTS 1000
#define BITS_PER_WORD 32
#define WORD_COUNT ((MAX_ELEMENTS + BITS_PER_WORD - 1) / BITS_PER_WORD)

unsigned int bitmap[WORD_COUNT];

// è®¾ç½®æŒ‡å®šä½
void setBit(int n) {
    bitmap[n / BITS_PER_WORD] |= (1U << (n % BITS_PER_WORD));
}

// æ¸…é™¤æŒ‡å®šä½
void clearBit(int n) {
    bitmap[n / BITS_PER_WORD] &= ~(1U << (n % BITS_PER_WORD));
}

// æµ‹è¯•æŒ‡å®šä½
int testBit(int n) {
    return (bitmap[n / BITS_PER_WORD] & (1U << (n % BITS_PER_WORD))) != 0;
}

// ç¿»è½¬æŒ‡å®šä½
void toggleBit(int n) {
    bitmap[n / BITS_PER_WORD] ^= (1U << (n % BITS_PER_WORD));
}
```

ä½å›¾å¯ç”¨äºå®ç°é›†åˆã€ç¨€ç–æ ‡è®°æˆ–å†…å­˜ç´§å¼ çš„åœºæ™¯ä¸‹çš„å¸ƒå°”æ•°ç»„ã€‚

### 2. æƒé™å’Œæ ‡å¿—ç®¡ç†

ä½¿ç”¨ä½æ©ç ç®¡ç†æƒé™æˆ–æ ‡å¿—ï¼š

```c
// å®šä¹‰æƒé™æ©ç 
#define READ    (1 << 0)    // 0001
#define WRITE   (1 << 1)    // 0010
#define EXECUTE (1 << 2)    // 0100
#define OWNER   (1 << 3)    // 1000

// è®¾ç½®æƒé™
int permissions = 0;
permissions |= READ | WRITE;  // æˆäºˆè¯»å†™æƒé™

// æ£€æŸ¥æƒé™
if (permissions & READ) {
    // æœ‰è¯»æƒé™
}

// ç§»é™¤æƒé™
permissions &= ~WRITE;  // ç§»é™¤å†™æƒé™

// åˆ‡æ¢æƒé™
permissions ^= EXECUTE;  // ç¿»è½¬æ‰§è¡Œæƒé™
```

è¿™ç§æ–¹å¼åœ¨ç³»ç»Ÿç¼–ç¨‹å’Œé…ç½®ç®¡ç†ä¸­éå¸¸å¸¸è§ã€‚

## ç³»ç»Ÿä¸åº•å±‚ç¼–ç¨‹åº”ç”¨

### 1. å¤§å°ç«¯æ£€æµ‹

æ£€æµ‹ç³»ç»Ÿçš„å­—èŠ‚åºï¼ˆå¤§ç«¯æˆ–å°ç«¯ï¼‰ï¼š

```c
int isLittleEndian() {
    unsigned int x = 1;
    return *((unsigned char *)&x);
}
```

å¦‚æœè¿”å›1ï¼Œè¡¨ç¤ºç³»ç»Ÿæ˜¯å°ç«¯å­—èŠ‚åºï¼›å¦‚æœè¿”å›0ï¼Œè¡¨ç¤ºç³»ç»Ÿæ˜¯å¤§ç«¯å­—èŠ‚åºã€‚

### 2. æ•°æ®å¯¹é½

ä½¿ç”¨æ©ç æ£€æŸ¥æˆ–å¼ºåˆ¶æ•°æ®å¯¹é½ï¼š

```c
// æ£€æŸ¥åœ°å€æ˜¯å¦æŒ‰4å­—èŠ‚å¯¹é½
int isAligned(void *ptr) {
    return ((uintptr_t)ptr & 0x3) == 0;
}

// å°†åœ°å€å‘ä¸Šå¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œ
void *alignUp(void *ptr) {
    return (void*)(((uintptr_t)ptr + 3) & ~0x3);
}
```

### 3. å¾ªç¯ä½ç§»

åœ¨æŸäº›åŠ å¯†ç®—æ³•å’Œæ ¡éªŒå’Œè®¡ç®—ä¸­ï¼Œå¾ªç¯ä½ç§»æ˜¯åŸºæœ¬æ“ä½œï¼š

```c
// 32ä½æ•´æ•°å¾ªç¯å·¦ç§»
unsigned int rotateLeft(unsigned int value, int shift) {
    if ((shift &= 31) == 0)
        return value;
    return (value << shift) | (value >> (32 - shift));
}

// 32ä½æ•´æ•°å¾ªç¯å³ç§»
unsigned int rotateRight(unsigned int value, int shift) {
    if ((shift &= 31) == 0)
        return value;
    return (value >> shift) | (value << (32 - shift));
}
```

## å›¾å½¢ä¸å¤šåª’ä½“å¤„ç†

### 1. é¢œè‰²æ“ä½œ

å¤„ç†RGBé¢œè‰²åˆ†é‡ï¼š

```c
// ä»RGBåˆ†é‡åˆ›å»ºé¢œè‰²å€¼
unsigned int makeRGB(unsigned char r, unsigned char g, unsigned char b) {
    return ((unsigned int)r << 16) | ((unsigned int)g << 8) | b;
}

// æå–RGBåˆ†é‡
unsigned char getRed(unsigned int rgb) {
    return (rgb >> 16) & 0xFF;
}

unsigned char getGreen(unsigned int rgb) {
    return (rgb >> 8) & 0xFF;
}

unsigned char getBlue(unsigned int rgb) {
    return rgb & 0xFF;
}

// é¢œè‰²é€æ˜åº¦æ··åˆ
unsigned int alphaBlend(unsigned int bg, unsigned int fg, unsigned char alpha) {
    unsigned int bg_r = getRed(bg);
    unsigned int bg_g = getGreen(bg);
    unsigned int bg_b = getBlue(bg);
    unsigned int fg_r = getRed(fg);
    unsigned int fg_g = getGreen(fg);
    unsigned int fg_b = getBlue(fg);
    
    unsigned int r = ((fg_r * alpha) + (bg_r * (255 - alpha))) / 255;
    unsigned int g = ((fg_g * alpha) + (bg_g * (255 - alpha))) / 255;
    unsigned int b = ((fg_b * alpha) + (bg_b * (255 - alpha))) / 255;
    
    return makeRGB(r, g, b);
}
```

### 2. å¿«é€Ÿçš„2Dç½‘æ ¼è®¿é—®

ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–2Dç½‘æ ¼çš„ç´¢å¼•è®¡ç®—ï¼ˆå½“å®½åº¦æ˜¯2çš„å¹‚æ—¶ï¼‰ï¼š

```c
// å‡è®¾ç½‘æ ¼å®½åº¦ä¸º2çš„å¹‚ï¼Œå¦‚32ã€64ã€128ç­‰
#define GRID_WIDTH_POWER 6  // 2^6 = 64
#define GRID_WIDTH (1 << GRID_WIDTH_POWER)
#define GRID_MASK (GRID_WIDTH - 1)  // ç”¨äºå–æ¨¡è¿ç®—

// ä»2Dåæ ‡è·å–1Dç´¢å¼•
int getIndex(int x, int y) {
    return (y << GRID_WIDTH_POWER) | (x & GRID_MASK);
}

// ä»1Dç´¢å¼•è·å–Xåæ ‡
int getX(int index) {
    return index & GRID_MASK;
}

// ä»1Dç´¢å¼•è·å–Yåæ ‡
int getY(int index) {
    return index >> GRID_WIDTH_POWER;
}
```

## ç®—æ³•ä¼˜åŒ–

### 1. è®¡ç®—äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°ï¼ˆä½è®¡æ•°ï¼‰

```c
// æœ´ç´ æ–¹æ³•
int countBits1(unsigned int n) {
    int count = 0;
    while (n) {
        count += n & 1;
        n >>= 1;
    }
    return count;
}

// Brian Kernighanç®—æ³•
int countBits2(unsigned int n) {
    int count = 0;
    while (n) {
        n &= (n - 1);  // æ¸…é™¤æœ€ä½ä½çš„1
        count++;
    }
    return count;
}

// æŸ¥è¡¨æ³•ï¼ˆé€‚ç”¨äºå­—èŠ‚çº§åˆ«ï¼‰
int countBits3(unsigned int n) {
    static const unsigned char BitsSetTable256[256] = {
        0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4,
        /* ... ä½™ä¸‹éƒ¨åˆ†çœç•¥ ... */
    };
    
    return BitsSetTable256[n & 0xff] + 
           BitsSetTable256[(n >> 8) & 0xff] + 
           BitsSetTable256[(n >> 16) & 0xff] + 
           BitsSetTable256[n >> 24];
}
```

### 2. ç§»é™¤æœ€å³è¾¹çš„1

```c
int removeRightmost1(int n) {
    return n & (n - 1);
}
```

è¿™ä¸ªæŠ€å·§åœ¨è®¸å¤šä½è¿ç®—ç®—æ³•ä¸­éå¸¸æœ‰ç”¨ï¼Œå¦‚Brian Kernighançš„ä½è®¡æ•°ç®—æ³•ã€‚

### 3. æå–æœ€å³è¾¹çš„1

```c
int extractRightmost1(int n) {
    return n & (-n);
}
```

è¿™åœ¨æŸäº›ç®—æ³•å¦‚"æ ‘çŠ¶æ•°ç»„"(Binary Indexed Tree)ä¸­æœ‰åº”ç”¨ã€‚

## å“ˆå¸Œå‡½æ•°

ä½è¿ç®—åœ¨å“ˆå¸Œå‡½æ•°å®ç°ä¸­éå¸¸å¸¸è§ï¼š

```c
// ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²å“ˆå¸Œå‡½æ•°
unsigned int simpleHash(const char *str) {
    unsigned int hash = 0;
    while (*str) {
        hash = (hash << 5) + hash + *str++;  // hash * 33 + å½“å‰å­—ç¬¦
    }
    return hash;
}

// FNV-1aå“ˆå¸Œç®—æ³•
unsigned int fnv1a_hash(const char *str) {
    unsigned int hash = 2166136261u;  // FNVåç§»åŸºæ•°
    while (*str) {
        hash ^= (unsigned char)*str++;
        hash *= 16777619;  // FNVç´ æ•°
    }
    return hash;
}
```

> ğŸ“ **è®°å¿†è¦ç‚¹**ï¼šä½è¿ç®—åœ¨å„ç§åº”ç”¨åœºæ™¯ä¸­éƒ½èƒ½æä¾›æ•ˆç‡å’ŒåŠŸèƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚ç†Ÿæ‚‰å¸¸è§çš„ä½è¿ç®—æŠ€å·§å¯ä»¥å¸®åŠ©ç¼–å†™æ›´é«˜æ•ˆçš„ä»£ç ï¼Œç‰¹åˆ«æ˜¯åœ¨èµ„æºå—é™æˆ–æ€§èƒ½å…³é”®çš„ç¯å¢ƒä¸­ã€‚

[^1]: ä½è¿ç®—æ˜¯Cè¯­è¨€ä¸­ç›´æ¥æ“ä½œå†…å­˜æ•°æ®ä½çš„æœ‰åŠ›å·¥å…·ï¼Œå®ƒçš„åº”ç”¨èŒƒå›´ä»åŸºæœ¬çš„æ ‡å¿—ç®¡ç†åˆ°å¤æ‚çš„ç®—æ³•ä¼˜åŒ–ã€‚æ­£ç¡®ç†è§£å’Œåº”ç”¨ä½è¿ç®—å¯ä»¥æ˜¾è‘—æé«˜ä»£ç æ•ˆç‡ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œå¹¶è§£å†³è®¸å¤šçœ‹ä¼¼å¤æ‚çš„é—®é¢˜ã€‚æŒæ¡ä½è¿ç®—æŠ€å·§æ˜¯æ¯ä¸ªç³»ç»Ÿç¨‹åºå‘˜å’ŒåµŒå…¥å¼å¼€å‘è€…çš„å¿…å¤‡èƒ½åŠ›ã€‚ 