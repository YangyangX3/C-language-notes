---
title: for 循环基础
tags: [C语言, 控制流, 循环, for, while, 循环次数, 循环变量, 初始化, 条件, 步进]
---

# 5.1 for 循环基础

`for` 循环是 C 语言提供的第三种循环结构，也是一种非常常用的循环形式，特别适合于循环次数已知或有明确范围的情况。

## `for` 循环的结构

`for` 循环将循环控制的三个关键部分——**初始化**、**条件**和**步进**（或称为调整）——集中写在了一起。

-   **基本语法**:
    ```c
    for ( <初始化表达式>; <循环条件>; <步进表达式> ) {
        // 循环体语句
    }
    ```
-   **三个组成部分**:
    1.  **初始化表达式 (Initialization)**: 在循环开始前**仅执行一次**。通常用于初始化循环控制变量（如 `int i = 0;`）。
    2.  **循环条件 (Condition)**: 在**每次循环迭代开始前**进行判断。如果条件为真 (非零)，则执行循环体；如果为假 (零)，则结束循环。
    3.  **步进表达式 (Step/Update)**: 在**每次循环体执行完毕后**执行。通常用于修改循环控制变量（如 `i++`）。
-   **分号**: 三个部分之间必须用分号 `;` 隔开。即使某个部分为空，分号也不能省略。

## 执行流程

1.  执行 `<初始化表达式>`。
2.  判断 `<循环条件>`。
3.  如果条件为假，跳出 `for` 循环，执行后续代码。
4.  如果条件为真，执行循环体 `{}` 中的语句。
5.  执行 `<步进表达式>`。
6.  回到步骤 2，重新判断条件。

**示例：计算阶乘 (Factorial)**
计算 n! = 1 * 2 * 3 * ... * n

```c
#include <stdio.h>

int main() {
    int n;
    printf("请输入一个正整数 n: ");
    scanf("%d", &n);

    long long factorial = 1; // 使用 long long 防止溢出
    int i; // 循环控制变量

    // for 循环计算阶乘
    for (i = 1; i <= n; i++) { // 初始化 i=1; 条件 i<=n; 步进 i++
        factorial *= i; // 循环体：累乘
    }

    printf("%d! = %lld\n", n, factorial);

    return 0;
}
```
-   **初始化**: `i = 1`
-   **条件**: `i <= n`
-   **步进**: `i++`
-   **循环体**: `factorial *= i;`

## `for` 与 `while` 的等价性

任何 `for` 循环都可以被等价地改写为 `while` 循环。

-   **`for` 循环**:
    ```c
    for ( init; condition; step ) {
        statements;
    }
    ```
-   **等价的 `while` 循环**:
    ```c
    init; // 初始化移到循环前
    while ( condition ) { // 条件作为 while 的条件
        statements; // 循环体
        step;       // 步进移到循环体末尾
    }
    ```

**示例：阶乘的 `while` 版本**
```c
#include <stdio.h>

int main() {
    int n;
    printf("请输入一个正整数 n: ");
    scanf("%d", &n);

    long long factorial = 1; 
    int i; 

    // while 循环计算阶乘 (等价于上面的 for 循环)
    i = 1; // 初始化
    while (i <= n) { // 条件
        factorial *= i; // 循环体
        i++;           // 步进
    }

    printf("%d! = %lld\n", n, factorial);

    return 0;
}
```

反之，`while` 循环也可以改写成 `for` 循环，但有时 `for` 的头部会显得比较空：

-   **`while` 循环**:
    ```c
    // 可能有某些初始化
    while ( condition ) {
        // 循环体，可能包含步进逻辑
    }
    ```
-   **可能的 `for` 改写**:
    ```c
    // 初始化移到 for 头部或之前
    for ( ; condition; /* 步进可能在循环体内完成 */ ) {
        // 循环体
    } 
    ```
    如果 `while` 循环的初始化和步进逻辑不明显或分散，强行写成 `for` 可能降低可读性。

## `for` 循环的灵活性与省略

`for` 循环头部的三个部分都可以省略，但分号必须保留。

1.  **省略初始化**: 如果变量已在循环前初始化。
    ```c
    int i = 0;
    for ( ; i < 10; i++ ) { ... }
    ```
2.  **省略条件**: 如果省略条件，默认为真，会形成**无限循环**（除非循环体内有 `break` 或 `return`）。
    ```c
    for ( int i = 0; ; i++ ) { // 无限循环
        // 需要在内部 break
        if (some_condition) {
            break; 
        }
    }
    ```
    `for (;;)` 是最常见的无限循环写法。
3.  **省略步进**: 如果步进操作在循环体内完成。
    ```c
    for ( int i = 0; i < 10; ) { 
        // ... 
        i++; // 在循环体内步进
    }
    ```
4.  **省略多个或全部**:
    ```c
    int i = 0;
    for ( ; i < 10 ; ) { // 等价于 while(i < 10)
        // ...
        i++;
    }

    for ( ; ; ) { // 等价于 while(1)
        // 无限循环体
    }
    ```
    `for (; condition; )` 在形式上完全等价于 `while (condition)`。

## 循环次数计算

对于常见的计数循环：

-   **`for (i = 0; i < n; i++)`**:
    -   `i` 的取值范围: 0, 1, 2, ..., n-1
    -   循环次数: **n** 次
    -   循环结束时 `i` 的值: **n**
-   **`for (i = 1; i <= n; i++)`**:
    -   `i` 的取值范围: 1, 2, 3, ..., n
    -   循环次数: **n** 次
    -   循环结束时 `i` 的值: **n + 1**

虽然两种写法循环次数相同，但在循环体内 `i` 的值以及循环结束时 `i` 的值是不同的。选择哪种写法取决于具体问题中索引是从 0 开始还是从 1 开始更自然。在 C 语言中，尤其是涉及数组时，从 0 开始计数（第一种写法）更为常见。

## 如何选择循环结构

-   **`for`**: 最适合**循环次数已知**或**循环变量有明确范围和递增/递减规律**的情况（如遍历计数、数组遍历等）。
-   **`do-while`**: 最适合**循环体至少需要执行一次**的情况（如菜单输入、猜数字等）。
-   **`while`**: 最适合**循环次数未知，由某个条件控制**的情况，且循环体可能一次都不执行（如读取文件直到末尾、等待某个事件发生、使用哨兵值结束输入等）。

虽然 `for` 和 `while` 在功能上可以相互转换，但选择更能清晰表达循环逻辑的结构，可以提高代码的可读性。